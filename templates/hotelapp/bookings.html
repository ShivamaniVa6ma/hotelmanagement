{% extends 'base.html' %}
{% block content %}
{% load static %}

<style>
  .Upload_payment{
      display: flex;
      justify-content: space-between;
      align-items: baseline;
  }
  /* id proof selection styles */
    /* ID Proof Selection Styling */
    .proof-selection {
      background: #ffffff;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      border: 1px solid #e6e9f0;
  }

  .proof-selection .card-title {
      color: #2c3e50;
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      padding-bottom: 10px;
      padding-top: 13px;
      border-bottom: 2px solid #f0f2f5;
  }

  .proof-selection .form-label {
      color: #4a5568;
      font-weight: 500;
      margin-bottom: 1rem;
  }

  .form-check-input {
      width: 18px;
      height: 18px;
      margin-top: 2px;
      border: 2px solid #cbd5e0;
      transition: all 0.2s ease;
  }

  .form-check-input:checked {
      background-color: #4c84ff;
      border-color: #4c84ff;
      box-shadow: 0 0 0 2px rgba(76, 132, 255, 0.2);
  }

  .form-check-label {
      color: #4a5568;
      font-weight: 500;
      padding-left: 8px;
  }

  .error-message {
      color: #e53e3e;
      font-size: 0.875rem;
      margin-top: 8px;
      padding: 8px 12px;
      background: #fff5f5;
      border-radius: 8px;
      border-left: 3px solid #e53e3e;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
      .form-check-inline {
          width: 100%;
          margin-bottom: 10px;
          margin-right: 0;
      }

      .proof-selection {
          padding: 20px;
      }
  }

    /* Proof Number Input Field Styling */
    .proof-input-section {
      background: #ffffff;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      border: 1px solid #e6e9f0;
      margin-top: 20px;
  }

  .proof-input-section .form-label {
      color: #2c3e50;
      font-weight: 500;
      font-size: 1rem;
      margin-bottom: 12px;
      display: block;
  }

  .proof-input-section .form-control {
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      padding: 12px 15px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background-color: #f8fafc;
  }

  .proof-input-section .form-control:focus {
      border-color: #4c84ff;
      box-shadow: 0 0 0 3px rgba(76, 132, 255, 0.1);
      background-color: #ffffff;
  }

  .proof-input-section .form-text {
      color: #718096;
      font-size: 0.875rem;
      margin-left: 5px;
      border-radius: 8px;
      border-left: 3px solid #4c84ff;
  }

  .proof-input-section .invalid-feedback {
      color: #e53e3e;
      font-size: 0.875rem;
      margin-top: 8px;
      padding: 8px 12px;
      background: #fff5f5;
      border-radius: 8px;
      border-left: 3px solid #e53e3e;
  }

  .text-danger {
      color: #e53e3e;
      font-weight: 500;
  }
  /* end id proof */

.offcanvas-body {
  padding: 2rem;
  background: #e2f1f8 !important;
}

  @media (max-width: 768px) {
    
      .dropdown {
  width: 86% !important;
}
  }

  .form_width{
      width: 300px;
  }

   /* Add these styles to your existing style section */
   select.form-control {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e6ed;
      border-radius: 10px;
      background-color: #fff;
      font-size: 1rem;
      color: #495057;
      transition: all 0.3s ease;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23566a7f' viewBox='0 0 16 16'%3E%3Cpath d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 15px center;
      background-size: 12px;
  }

  select.form-control:focus {
      border-color: #4a90e2;
      box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
      outline: none;
  }

  select.form-control:hover {
      border-color: #4a90e2;
  }

  select.form-control option {
      padding: 12px;
  }

  select.form-control option:not(:first-child) {
      border-top: 1px solid #f0f0f0;
  }

  .room_info{
  display: flex;
  align-items: center;
  justify-content: space-around;
  flex-wrap: wrap;
  }
  .form_group{
      display: flex;
      justify-content: space-between;
      align-items: center;
  }
    /* Add these styles to your existing style section */
    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
  }

  .form-row .form-group {
      flex: 1;
      margin-bottom: 0;
  }

  @media (max-width: 576px) {
      .form-row {
          flex-direction: column;
          gap: 15px;
      }
  }

/* Add these styles to your existing style section */
.room-card {
      background: #ffffff !important;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      position: relative;
      border: 1px solid #e0e6ed;
      transition: all 0.3s ease;
  }

  .room-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
  }

  .remove-btn {
      position: absolute;
      right: 15px;
      top: 15px;
      background: #ff5a5a;
      color: white !important;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
  }

  .remove-btn:hover {
      background: #ff3333;
      transform: scale(1.1);
  }

  .room-type-header {
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 15px;
      margin-bottom: 20px;
  }

  .room-type-header h5 {
      color: #2c3e50;
      font-weight: 600;
      margin: 0;
  }

  .form-group {
      margin-bottom: 20px;
  }

  .form-group label {
      color: #566a7f;
      font-weight: 500;
      margin-bottom: 8px;
      display: block;
  }

  .form-control {
      border: 2px solid #e0e6ed;
      border-radius: 10px;
      padding: 12px 15px;
      transition: all 0.3s ease;
      /* width: 50%; */
  }

  .form-control:focus {
      border-color: #4a90e2;
      box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
  }

  .room-details {
      background: #f8fafc;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
     
  }

  .price-text, .availability-text {
      color: #566a7f;
      margin-bottom: 15px;
      font-size: 0.95rem;
  }

  .room-price {
      color: #2ecc71;
      font-weight: 600;
      font-size: 1.1rem;
  }

  .room-availability {
      color: #3498db;
      font-weight: 600;
  }

  .number-input {
      width: 100%;
      padding: 10px 15px;
      border: 2px solid #e0e6ed;
      border-radius: 10px;
      text-align: center;
  }

  /* Custom select styling */
  select.form-control {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23566a7f' viewBox='0 0 16 16'%3E%3Cpath d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 15px center;
      background-size: 12px;
  }



/* offcanvas updated styles */
/*new styles*/
.offcanvas-body{
background-color:#e2f1f8;
}


.offcanvas-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 1040;
  width: 100vw;
  height: 100vh;
  background-color: #2b2a2a;
}
.offcanvas-backdrop.show {
  opacity: 0.5;
}

/*payment type*/
.payment-select {
                  width: 100%;
                  /* padding: 12px 15px; */
                  border: 2px solid #e0e6ed;
                  border-radius: 10px;
                  background-color: #fff;
                  font-size: 1rem;
                  color: #495057;
                  transition: all 0.3s ease;
                  appearance: none;
                  -webkit-appearance: none;
                  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23495057' class='bi bi-chevron-down' viewBox='0 0 16 16'%3E%3Cpath d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
                  background-repeat: no-repeat;
                  background-position: right 15px center;
                  background-size: 12px;
              }

              .payment-select:focus {
                  border-color: #1a73e8;
                  box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
                  outline: none;
              }

              .payment-select option {
                  padding: 12px;
              }

              .payment-select option:not(:first-child) {
                  border-top: 1px solid #f0f0f0;
              }

              .payment-select:hover {
                  border-color: #1a73e8;
                  cursor: pointer;
              }

              /* Add hover effect */
              .payment-select option:hover {
                  background-color: #f8f9fa;
              }
.guest-row {
  background-color: #ffffff;
  padding: 10px;
  border-radius: 13px;
              }

             .row .guest_count_row{
                padding: 5px;
  background-color: #ffffff;
  margin-top: 15px;
  border-radius: 15px;
              }

         .room_container{
          margin-top: 15px;
         }    


/* Offcanvas Styling */
.offcanvas-end {
      width: 680px;
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
      background: linear-gradient(145deg, #f6f8fd, #ffffff);
  }

  .offcanvas-header {
      background:#330481;
      padding: 1.02rem 2rem;
      
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  }

  .offcanvas-title {
      font-size: 1.5rem;
      color: #ffffff;
      font-weight: 600;
      letter-spacing: 0.5px;
  }

  .offcanvas-body {
      padding: 2rem;
      background: #f8faff;
  }

  /* Form Sections */
  .offcanvas-body .row {
      background: #ffffff;
      border-radius: 15px;
      padding: 10px;
      margin-bottom: 1.5rem;
      box-shadow: 0 3px 15px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
  }

  .offcanvas-body .row:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
  }

  /* Form Controls */
  .form-control {
      border: 2px solid #e9ecef;
      border-radius: 10px;
      padding: 0.75rem 1rem;
      transition: all 0.3s ease;
      background: #f8faff;
  }

  .form-control:focus {
      border-color: #4c84ff;
      box-shadow: 0 0 0 4px rgba(76, 132, 255, 0.1);
      background: #ffffff;
  }

  /* Labels */
  .form-label {
      font-weight: 500;
      color: #2c3e50;
      margin-bottom: 0.75rem;
      font-size: 0.95rem;
  }

  .form-label h6 {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 0;
  }

  /* Room Container */
  .room_container {
      background: #0af9e021;
      border-radius: 15px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 3px 15px rgba(0, 0, 0, 0.05);
  }

  /* Dropdown Styling */
  .dropdown-container {
      background: #ffffff;
      border-radius: 12px;
      padding: 1.25rem;
      margin-bottom: 1rem;
  }

  .dropdown-toggle {
      background: linear-gradient(145deg, #ffffff, #f8faff);
      border: 2px solid #e9ecef;
      border-radius: 10px;
      padding: 0.75rem 1.25rem;
      transition: all 0.3s ease;
  }

  /* .dropdown-toggle:hover {
      background: #f8faff;
      border-color: #4c84ff;
  } */

  /* Messages */
  .messages .alert {
      border-radius: 12px;
      margin-bottom: 1.5rem;
      border: none;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
      .offcanvas-end {
          width: 100%;
      }
     
      .offcanvas-body {
          padding: 1rem;
      }
     
      .offcanvas-body .row {
          padding: 1rem;
      }
  }

  /* Animations */
  .offcanvas.show {
      animation: slideIn 0.3s ease-out;
  }

  @keyframes slideIn {
      from {
          transform: translateX(100%);
      }
      to {
          transform: translateX(0);
      }
  }

  /* Custom Scrollbar */
  .offcanvas-body::-webkit-scrollbar {
      width: 8px;
  }

  .offcanvas-body::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
  }

  .offcanvas-body::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
  }

  .offcanvas-body::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
  }

  /* Input Focus States */
  .form-control:focus + .form-label {
      color: #4c84ff;
  }

  /* Error States */
  .invalid-feedback {
      font-size: 0.85rem;
      color: #dc3545;
      margin-top: 0.5rem;
  }

  .form-control.is-invalid {
      border-color: #dc3545;
      box-shadow: 0 0 0 4px rgba(220, 53, 69, 0.1);
  }

  .offcanvas-header .btn-close{
    background-color: #ffffff;
  }

  /* end offcavas styles updated */


/* .offcanvas-backdrop.show {
  opacity: 0.25;
} */

.room-card {
  background: #f8f9ff;
  border-radius: 12px;
  padding: 15px;
  margin-top: 15px;
  border: 1px solid #e0e0ff;
  transition: all 0.3s ease;
  margin-bottom: 15px;
}

.hidden {
  display: none;
}

.room-type-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
}

.room-type-header .form-check-input {
  width: 20px;
  height: 20px;
}

.room-details {
  border-radius: 8px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
}

.price-text {
  font-size: 1.1rem;
  font-weight: 500;
  margin-bottom: 10px;
}

.availability-text {
  color: #444;
  margin-bottom: 15px;
}

.number-input {
  width: 100px;
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 5px 10px;
}

.ac-options, .bed-options {
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid #eee;
}

.form-check-input:checked {
  background-color: #0d6efd;
  border-color: #0d6efd;
}

.remove-btn {
  color: #dc3545;
  cursor: pointer;
  font-size: 1.2rem;
  position: absolute;
  right: 15px;
  top: 15px;
}

.remove-btn:hover {
  color: #bb2d3b;
}

.selected-rooms {
  margin-top: 20px;
}

.room-card {
  position: relative;
}

.btn-check:checked + .btn-outline-primary {
  background-color: #0d6efd;
  color: white;
}

.dropdown-container {
  display: flex;
  align-items: flex-end;
  gap: 15px;
}

.add-more-text {
  color: #0d6efd;
  font-weight: 500;
  margin-bottom: 8px;
  display: none;
  cursor: pointer;
  text-align: center;
  font-size: 1rem;
}

.dropdown {
  width: 21%;
}

.dropdown-toggle {
  width: 100%;
}

.dropdown-menu {
  width: 21%;
}

.form-select-room {
  width: 22%;
  padding: 10px;
}

@media (min-width: 576px) {
  .add-more-text {
    font-size: 1.2rem;
  }
}

@media (min-width: 320px) {
  .add-more-text {
    font-size: 13px;
  }
}



/* Existing styles... */
  
  /* Dark mode styles for offcanvas */
  body.dark-mode .offcanvas {
    background-color: var(--card-bg);
    color: var(--text-color);
  }
  
  body.dark-mode .offcanvas-header {
    border-bottom: 1px solid var(--border-color);
  }
  
  body.dark-mode .offcanvas-title {
    color: var(--text-color);
  }
  
  body.dark-mode .btn-close {
    filter: invert(1) grayscale(100%) brightness(200%);
  }
  
  body.dark-mode .offcanvas-body {
    background-color: var(--card-bg);
  }
  
  body.dark-mode .form-control,
  body.dark-mode .form-select {
    background-color: var(--input-bg);
    border-color: var(--border-color);
    color: var(--text-color);
  }
  
  body.dark-mode .form-label,
  body.dark-mode .form-check-label {
    color: var(--text-color);
  }
  
  body.dark-mode .dropdown-menu {
    background-color: var(--dropdown-bg);
    border-color: var(--border-color);
  }
  
  body.dark-mode .dropdown-item {
    color: var(--text-color);
  }
  
  body.dark-mode .dropdown-item:hover {
    background-color: var(--hover-bg);
  }
  
  body.dark-mode .proof-selection {
    background-color: var(--card-bg);
    border-color: var(--border-color);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  }
  
  body.dark-mode .proof-selection .card-title {
    color: var(--text-color);
    border-bottom-color: var(--border-color);
  }
  
  body.dark-mode .proof-selection .form-label {
    color: var(--text-color);
  }
  
  body.dark-mode .alert {
    background-color: var(--card-bg);
    border-color: var(--border-color);
    color: var(--text-color);
  }
  
  /* Remove the offcanvas_default_color class and use theme variables instead */
  .offcanvas-body {
    transition: background-color 0.3s ease, color 0.3s ease;
  }
</style>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap5.min.css">

<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>

<div class="lh-main-content">
  <div class="container-fluid">
    <div class="lh-page-title">
      <div class="lh-breadcrumb">
        <h5>Bookings</h5>
        <!-- <ul>
          <li><a href="{% url 'admin-panel:index' %}">Home</a></li>
          <li>Bookings</li>
        </ul> -->
      </div>
      <div class="lh-tools">
        <div class="lh-breadcrumb me-3 ">
          <!-- <h5>Bookings</h5> -->
          <ul>
            <li><a href="{% url 'admin-panel:index' %}">Home</a></li>  <li> <i class="fas fa-angle-right pl3 pr3"></i></li>
            <li>Bookings</li>
          </ul>
        </div>
        <a href="javascript:void(0)" title="Refresh" class="refresh"
                ><i class="ri-refresh-line"></i
              ></a>
              <div id="pagedate">
                <div class="lh-date-range" title="Date">
                  <span></span>
                </div>
              </div>

              <div class="filter">
                <div class="dropdown" title="Filter">
                  <button
                    class="btn dropdown-toggle"
                    type="button"
                    id="dropdownMenuButton1"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                    >
                  
                    <i class="ri-sound-module-line"></i>
                  </button>
                  <ul
                    class="dropdown-menu"
                    aria-labelledby="dropdownMenuButton1"
                  >
                    <li><a class="dropdown-item" href="#">Booking</a></li>
                    <li><a class="dropdown-item" href="#">Revenue</a></li>
                    <li><a class="dropdown-item" href="#">Expence</a></li>
                  </ul>
                </div>
              </div>

        <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#bookingOffcanvas">
          <i class="fas fa-plus-circle me-2"></i>Book Room
        </button>
      </div>
    </div>
    <div class="row">
      <div class="col-xl-12 col-md-12">
        <div class="lh-card" id="bookingtbl">
          <div class="lh-card-header">
            <h4 class="lh-card-title">Latest Bookings</h4>
            <div class="header-tools">
              <a href="javascript:void(0)" class="m-r-10 lh-full-card"
                ><i class="ri-fullscreen-line" title="Full Screen"></i
              ></a>
              <!-- <div class="lh-date-range dots">
                <span></span>
              </div> -->
            </div>
          </div>
          <div class="lh-card-content card-default">
            <div class="booking-table">
              <div class="table-responsive">
                <table id="booking_table" class="table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Room Type</th>
                      <th>RoomNo</th>
                      <th>CheckIn</th>
                      <th>CheckOut</th>
                      <th>Proof</th>
                      <th>Payment</th>
                      <th>Amount</th>
                      <th>Status</th>
                      
                      <!-- <th>Action</th> -->
                    </tr>
                  </thead>
                  <tbody>
                    {% if bookings %}
                    {% for booking in bookings %}

                    <tr>
                      <td class="token"> {{ booking.id}} </td>
                      <td>
                        <!-- <img
                          class="cat-thumb"
                          src="{% static '/assets/img/room/1.png' %}"
                          alt="clients Image"
                        /> -->
                        <span class="name"> {{ booking.room.room_type }}</span>
                      </td>
                      <td>{{ booking.room.room_number }}-{{booking.room.block}} </td>
                      <td> {{ booking.check_in|date:"M d, Y H:i" }}</td>
                      <td>{{ booking.check_out|date:"M d, Y H:i" }}</td>
                      <td>{{ booking.guest.get_proof_type_display }} - {{ booking.guest.proof_no }}</td>

                      <td class="active">{{ booking.payment_type }}</td>
                      <td>â‚¹{{ booking.total_amount }}</td>
                      <td>
                        {% if booking.check_out > now %}
                            <span class="badge bg-success">Active</span>
                        {% else %}
                            <span class="badge bg-secondary">Completed</span>
                        {% endif %}
                    </td>
                      
                      <!-- <td class="rooms">
                        <span class="mem">6 Member</span> /
                        <span class="room">2 Room</span>
                      </td> -->
                      <!-- <td>
                        <div class="d-flex justify-content-center">
                          <a href="{% url 'admin-panel:booking_view' booking.id %}" class="btn btn-outline-primary me-2">
                            <i class="ri-eye-line"></i>
                          </a>
                          <a href="{% url 'admin-panel:delete_booking' booking.id %}" class="btn btn-outline-danger">
                            <i class="ri-delete-bin-line"></i>
                          </a>
                        </div>
                      </td> -->
                    </tr>
                      
                  
                    {% endfor %} 
                  {% else %}
                    <tr>
                        <td colspan="10" class="text-center">No Bookings Found.</td>
                    </tr>
                {% endif %}                    
                    
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container ">
  <div class="offcanvas offcanvas-end" tabindex="-1" id="bookingOffcanvas" aria-labelledby="bookingOffcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="bookingOffcanvasLabel">New Booking</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>

    <div class="offcanvas-body ">
      <form id="bookingForm" method="post" action="{% url 'admin-panel:multiple_bookings_create' %}" enctype="multipart/form-data">
        {% csrf_token %}
        
        <input type="hidden" id="roomTypeInput" name="room_type">
        <input type="hidden" name="bed_type" value="{{ bed_type }}">
        <input type="hidden" name="ac_type" value="{{ ac_type }}">
        <input type="hidden" name="sitting_capacity" value="{{ sitting_capacity }}">
      

        {% if messages %}
        <div class="messages">
          {% for message in messages %}
          <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
            {{ message }}
          </div>
          {% endfor %}
        </div>
        {% endif %}

        <input type="hidden" name="room_type" value="{{ room_type }}">
        <input type="hidden" name="bed_type" value="{{ bed_type }}">
        <input type="hidden" name="ac_type" value="{{ ac_type }}">
        <input type="hidden" name="sitting_capacity" value="{{ sitting_capacity }}">

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Check-in Date & Time<span style="color: red;    font-size: 15px;">*</span></label>
            <input type="datetime-local" name="check_in" id="check_in" class="form-control" required>
            {% if booking_form.check_in.errors %}
            <div class="invalid-feedback">
              {{ booking_form.check_in.errors }}
            </div>
            {% endif %}
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Check-out Date & Time<span style="color: red;    font-size: 15px;">*</span></label>
            <input type="datetime-local" name="check_out" id="check_out" class="form-control" required>
            {% if booking_form.check_out.errors %}
            <div class="invalid-feedback">
              {{ booking_form.check_out.errors }}
            </div>
            {% endif %}
          </div>
        </div>
<div class="row">
    <div class="col-md-12">
        <div class="container">
          <div class="form-container">
            <div class="mb-3">
              <div class="dropdown-container">
                <div style="flex: 1;">
                  <label for="roomType" class="form-label">Add Room Type<span style="color: red;    font-size: 15px;">*</span></label>
                  <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="roomTypeDropdownBtn" data-bs-toggle="dropdown" aria-expanded="false" style="width: 100%;">
                      Select Room Type
                    </button>
                    <ul class="dropdown-menu" id="roomTypeDropdown"></ul>
                  </div>
                </div>
                <div class="add-more-text" id="addMoreText" style="cursor: pointer;">Add More</div>
              </div>
            </div>

            <div id="selectedRooms"></div>
          </div>
        </div></div></div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Guest Name<span style="color: red;    font-size: 15px;">*</span></label>
            <input type="text" id="name" name="name" class="form-control" value="{{ guest_form.name.value|default:'' }}">

            {% if guest_form.name.errors %}
            <div class="invalid-feedback">
              {{ guest_form.name.errors }}
            </div>
            {% endif %}
          </div>
          
          <div class="col-md-6 mb-3">
            <label class="form-label">Phone Number<span style="color: red;    font-size: 15px;">*</span></label>
            <input type="text" id="phone" name="phone" class="form-control" value="{{ guest_form.phone.value|default:'' }}">
            {% if guest_form.phone.errors %}
            <div class="invalid-feedback">
              {{ guest_form.phone.errors }}
            </div>
            {% endif %}
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Email<span style="color: red;    font-size: 15px;">*</span></label>
            <input type="email" id="email" name="email" class="form-control" value="{{ guest_form.email.value|default:'' }}">
            {% if guest_form.email.errors %}
            <div class="invalid-feedback">
              {{ guest_form.email.errors }}
            </div>
            {% endif %}
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Address<span style="color: red;    font-size: 15px;">*</span></label>
            <textarea id="address" name="address" class="form-control">{{ guest_form.address.value|default:'' }}</textarea>
            {% if guest_form.address.errors %}
            <div class="invalid-feedback">
              {{ guest_form.address.errors }}
            </div>
            {% endif %}
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <div class="guest-info">
              <h6 class="mb-3">Guest Count</h6>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Adults<span style="color: red;    font-size: 15px;">*</span></label>
                  <input type="text" id="adults" name="adults" class="form-control" value="{{ guest_form.adults.value|default:'' }}">
                  {% if booking_form.adults.errors %}
                  <div class="invalid-feedback">
                    {{ booking_form.adults.errors }}
                  </div>
                  {% endif %}
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Children<span style="color: red;    font-size: 15px;">*</span></label>
                  <input type="text" id="children" name="children" class="form-control" value="{{ guest_form.children.value|default:'' }}">
                  {% if booking_form.children.errors %}
                  <div class="invalid-feedback">
                    {{ booking_form.children.errors }}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row proof-selection">
        <div class="col-md-5 mb-3 " style="width: 100%">
          <h6 class="card-title mb-4">ID Proof Selection</h6>
          <!-- Radio Buttons for Proof Type Selection -->
        <!-- <div class="mb-4"> -->
          <label class="form-label" for="proof_type">ID Proof Type <span class="text-danger">*</span></label>
          <div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="proof_type" id="aadharRadio" value="aadhar">
              <label class="form-check-label ms-2" for="aadharRadio">Aadhar Card</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="proof_type" id="panRadio" value="pan" >
              <label class="form-check-label ms-2" for="panRadio">PAN Card</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="proof_type" id="passportRadio" value="passport" >
              <label class="form-check-label ms-2" for="passportRadio">Passport</label>
            </div>
          </div>
          {% if guest_form.proof_type.errors %}
                            <div class="error-message">{{ guest_form.proof_type.errors.0 }}</div>
                        {% endif %}
      

        <!-- Proof Number Input Field -->
        <div class="mb-4 proof-input-section">
          <label id="proofLabel" for="proofInput" class="form-label">Enter ID Proof Number <span class="text-danger">*</span></label>
          <input 
            type="text" 
            id="proofInput" 
            name="proof_no"
            class="form-control" 
            value="{{ guest_form.proof_no.value|default:'' }}"
          >
          <div id="proofText" class="form-text">Select an ID proof type above</div>
          <div id="proofError" class="invalid-feedback"></div>
        </div>  </div></div>
        
        <div class="row Upload_payment">
          <div class="col-md-6">
            <div class="guest-info">
              <label class="form-label">Upload ID Proof<span style="color: red;    font-size: 15px;">*</span></label>
              <input 
                    type="file" 
                    name="proof_file" 
                    id="proofFile" 
                    class="form-control"
                    accept=".pdf,.jpg,.jpeg,.png"
                    required
                  >
              <!-- {{ guest_form.proof_file }} -->
              {% if guest_form.proof_file.errors %}
              <div class="invalid-feedback">
                {{ guest_form.proof_file.errors }}
              </div>
              {% endif %}
            </div>
          </div>

          <div class="col-md-6">
            <label for="payment_type" class="form-label">Payment Type<span style="color: red;    font-size: 15px;">*</span></label>
            <select name="payment_type" id="payment_type" class="form-control">
                <option value="">Select Payment Type</option>
                <option value="razorpay">Razorpay</option>
                <option value="cash">Cash</option>
                <option value="upi">UPI</option>
                <option value="card">Card</option>
                <option value="net_banking">Net Banking</option>
            </select>
            {% if booking_form.payment_type.errors %}
            <div class="invalid-feedback">
                {{ booking_form.payment_type.errors }}
            </div>
            {% endif %}
        </div>
        </div>

        <hr/>

        <div class="col-md-6 mb-3" style="display: flex; gap: 9px">
          <div class="row">
            <div class="col-12 text-end mt-4">
                    <div id="taxBreakdownContainer" class="mb-2"></div>

              <!-- <h5>Total Amount (incl. Tax): <span id="totalAmount">â‚¹0.00/-</span></h5> -->
              <input type="hidden" name="final_total_with_tax" id="finalTotalWithTaxInput">

            </div>
          </div>

        </div>

        <div class="d-grid gap-2" style="display: flex; justify-content: center; width: 100%; margin-top: 40px;">
          <button type="submit" id="confirmBookingButton" class="btn btn-primary">
            <i class="fas fa-check-circle me-2"></i>Confirm Booking
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<script>
document.getElementById('bookingForm').addEventListener('submit', function(event) {
    event.preventDefault();

    let selectedRooms = [];
    document.querySelectorAll('.room-card').forEach(function(roomCard) {
        let roomType = roomCard.querySelector('.room-type').value;
        let bedType = roomCard.querySelector('select[id^="bedTypeSelect_"]').value;
        let acType = roomCard.querySelector('select[id^="acTypeSelect_"]').value;
        let roomCount = roomCard.querySelector('.room-count').value;

        if (roomCount > 0) {
            selectedRooms.push({
                roomType: roomType,
                bedType: bedType,
                acType: acType,
                roomCount: roomCount
            });
        }
    });

    if (selectedRooms.length === 0) {
        Swal.fire({
            icon: 'warning',
            title: 'No Rooms Selected',
            text: 'Please select at least one room before submitting.'
        });
        return;
    }

    let formData = new FormData(this);
    formData.append('selectedRooms', JSON.stringify(selectedRooms));

    fetch(this.action, {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    }).then(response => response.json()).then(data => {
        if (data.success) {
            Swal.fire({
                icon: 'success',
                title: 'Booking Successful',
                text: data.message,
                confirmButtonText: 'OK'
            }).then(() => {
                window.location.href = data.redirect_url;
            });
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Booking Failed',
                text: data.error
            });
        }
    }).catch(error => {
        console.error('Error:', error);
        Swal.fire({
            icon: 'error',
            title: 'Unexpected Error',
            text: 'Something went wrong. Please try again later.'
        });
    });
});

document.addEventListener("DOMContentLoaded", function () {
    initializeEventListeners();
});

function updateRoomPriceAndAvailability(cardElement) {
    if (!cardElement) {
        console.warn("âŒ No cardElement provided for updateRoomPriceAndAvailability!");
        return;
    }

    let roomTypeSelect = cardElement.querySelector(".room-type");
    let bedTypeSelect = cardElement.querySelector('select[id^="bedTypeSelect_"]');
    let acTypeSelect = cardElement.querySelector('select[id^="acTypeSelect_"]');
    let seatingCapacitySelect = cardElement.querySelector('select[id^="seatingCapacitySelect_"]');
    let checkIn = document.querySelector('input[name="check_in"]').value;
    let checkOut = document.querySelector('input[name="check_out"]').value;

    let roomTypeId = roomTypeSelect ? roomTypeSelect.value : null;
    let acType = acTypeSelect ? acTypeSelect.value : null;
    let seatingCapacity = seatingCapacitySelect ? seatingCapacitySelect.value : null;
    let bedType = bedTypeSelect ? bedTypeSelect.value : null;

    // ðŸ”¥ Set bedType to null for conference rooms
    if (bedTypeSelect && roomTypeSelect && roomTypeSelect.value === "conference") {
        bedType = null;
    }

    if (!roomTypeId || !acType || !checkIn || !checkOut) {
        console.error("âŒ Missing required parameters!");
        return;
    }

    fetch('/admin-panel/get-room-price/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken'),
        },
        body: JSON.stringify({
            roomTypeId,
            bedType,
            acType,
            checkIn,
            checkOut,
            seatingCapacity
        }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const price = parseFloat(data.price).toFixed(2);
            const availability = typeof data.available_rooms === 'number' ? data.available_rooms : "No available rooms";
            const taxBreakdown = data.tax_breakdown || [];
            const totalWithTax = parseFloat(data.total_with_tax).toFixed(2);

            const priceElement = cardElement.querySelector('.room-price');
            const availabilityElement = cardElement.querySelector('.room-availability');
            const taxContainer = cardElement.querySelector('.room-tax-breakdown');

            if (priceElement) {
                priceElement.textContent = price;
                priceElement.setAttribute('data-room-price', price);
                priceElement.setAttribute('data-room-total-with-tax', totalWithTax); // âœ… Save total_with_tax for later calculation
            }

            if (availabilityElement) {
                availabilityElement.textContent = availability;
            }

            if (taxContainer) {
                taxContainer.innerHTML = '';
                taxBreakdown.forEach(tax => {
                    const line = document.createElement('div');
                    line.textContent = `${tax.name} (${tax.percentage}%): â‚¹${tax.amount}`;
                    taxContainer.appendChild(line);
                });
                const totalLine = document.createElement('div');
                totalLine.innerHTML = `<strong>Total (incl. tax): â‚¹${totalWithTax}/-</strong>`;
                taxContainer.appendChild(totalLine);
            }

            // ðŸ” Recalculate grand total after this card update
            let grandTotalWithTax = 0;
            document.querySelectorAll('.room-card').forEach(card => {
                const totalWithTaxStr = card.querySelector('.room-price')?.getAttribute('data-room-total-with-tax') || '0';
                const roomCountInput = card.querySelector('input[name^="roomCount"]');
                const roomCount = roomCountInput ? parseInt(roomCountInput.value) || 1 : 1;
                grandTotalWithTax += parseFloat(totalWithTaxStr) * roomCount;
            });

            const totalAmountEl = document.getElementById('totalAmount');
            if (totalAmountEl) {
                totalAmountEl.textContent = `â‚¹${grandTotalWithTax.toFixed(2)}/-`;
            }
            // ðŸ’¡ Update tax breakdown summary for all cards (combine breakdowns if needed)
            const taxBreakdownContainer = document.getElementById('taxBreakdownContainer');
            if (taxBreakdownContainer) {
                // Option 1: Just show last updated card's breakdown (simple way)
                taxBreakdownContainer.innerHTML = '';
                taxBreakdown.forEach(tax => {
                    const line = document.createElement('div');
                    line.className = 'text-end text-muted';
                    line.innerHTML = `${tax.name} (${tax.percentage}%): â‚¹${parseFloat(tax.amount).toFixed(2)}`;
                    taxBreakdownContainer.appendChild(line);
                });

                const totalLine = document.createElement('div');
                totalLine.innerHTML = `<strong>Total (incl. tax): â‚¹${grandTotalWithTax.toFixed(2)}/-</strong>`;
                taxBreakdownContainer.appendChild(totalLine);

                // Optional: Update hidden input for form submission
                document.getElementById('finalTotalWithTaxInput').value = grandTotalWithTax.toFixed(2);
            }


        } else {
            console.error("âŒ Error fetching room price:", data.error);
        }
    })
    .catch(error => {
        console.error("âš ï¸ Network error while fetching room price:", error);
    });
}


function initializeEventListeners() {
    document.addEventListener("change", function (event) {
        if (event.target && event.target.id === "roomType") {
            toggleRoomTypeFields();
        }
    });

    document.addEventListener("change", function (event) {
        if (event.target && event.target.id === "seatingCapacity") {
            onSeatingCapacityChange();
        }
    });

    // Run once in case elements exist on page load
    toggleRoomTypeFields();
}

document.addEventListener('DOMContentLoaded', function () {
    fetchRoomTypes();

    // Add event listeners for check-in and check-out fields
    document.querySelector('input[name="check_in"]').addEventListener('change', function() {
        document.querySelectorAll('.room-card').forEach(card => {
            updateRoomPriceAndAvailability(card);
        });
    });

    document.querySelector('input[name="check_out"]').addEventListener('change', function() {
        document.querySelectorAll('.room-card').forEach(card => {
            updateRoomPriceAndAvailability(card);
        });
    });
});

// Function to fetch room types dynamically
async function fetchRoomTypes() {
    try {
        const response = await fetch('/admin-panel/get-room-types/');
        if (!response.ok) {
            throw new Error(`HTTP Error! Status: ${response.status}`);
        }
        const data = await response.json();
        console.log("âœ… Room Types Data:", data);

        if (data.success) {
            populateRoomTypeDropdown(data.room_types);
        } else {
            console.error('Error fetching room types:', data.error);
        }
    } catch (error) {
        console.error('Network error while fetching room types:', error);
    }
}

// Populate Room Type Dropdown
function populateRoomTypeDropdown(roomTypes) {
    const dropdownMenu = document.getElementById('roomTypeDropdown');
    dropdownMenu.innerHTML = ''; // Clear previous options

    roomTypes.forEach(room => {
        const item = document.createElement('a');
        item.classList.add('dropdown-item');
        item.href = '#';
        item.dataset.id = room.id;
        item.dataset.name = room.name;
        item.textContent = room.name;

        item.addEventListener('click', async function (e) {
            e.preventDefault();
            const roomTypeId = this.dataset.id;
            const roomTypeName = this.dataset.name;

            const newRoomCard = await createRoomCard(roomTypeId, roomTypeName);
            if (newRoomCard) {
                document.getElementById('selectedRooms').appendChild(newRoomCard);
                updateRoomPriceAndAvailability(newRoomCard);  // âœ… Update price only when room is added
            }
        });

        dropdownMenu.appendChild(item);
    });
}

async function createRoomCard(roomTypeId, roomTypeName) {
    const uniqueId = `${roomTypeName.replace(/\s+/g, '_')}_${Date.now()}`;

    let bedType = await getBedType(roomTypeId);
    let seatingCapacityDropdown = "";

    if (bedType === "conference") {
        let seatingCapacities = await getSeatingCapacities(roomTypeId);
        seatingCapacityDropdown = `
            <div class="form-group">
                <label for="seatingCapacitySelect_${uniqueId}">Select Seating Capacity:</label>
                <select id="seatingCapacitySelect_${uniqueId}" class="form-control">
                    <option value="">Select Capacity</option>
                    ${seatingCapacities.map(capacity => `<option value="${capacity}">${capacity} People</option>`).join('')}
                </select>
            </div>`;
    }

    let cardHtml = `
    <div class="room-card" id="${uniqueId}" >
        <span class="remove-btn" onclick="removeRoom('${uniqueId}')">&times;</span>
        <div class="room-type-header">
            <h5 class="mb-0">${roomTypeName}</h5>
        </div>
        <input type="hidden" class="room-type" value="${roomTypeId}">


        <div class="room_info">
            <div  class="form-group form_width" ${bedType === "conference" ? 'style="display: none;"' : ''}>
                <label for="bedTypeSelect_${uniqueId}">Select Bed Type:</label>
                <select id="bedTypeSelect_${uniqueId}" class="form-control">
                    <option value="">Select Bed Type</option>
                    <option value="single">Single Bed</option>
                    <option value="double">Double Bed</option>
                    <option value="king">King Bed</option>
                    <option value="queen">Queen Bed</option>
                </select>
            </div>

            ${seatingCapacityDropdown}

            <div class="form-group form_width">
                <label for="acTypeSelect_${uniqueId}">Select AC Type:</label>
                <select id="acTypeSelect_${uniqueId}" class="form-control">
                    <option value="">Select AC Type</option>
                    <option value="ac">AC</option>
                    <option value="nonAc">Non-AC</option>
                </select>
            </div></div>

        <div class="room-details">
            <div class="price-text">
                <i class="fas fa-tag me-2"></i>Room Price: 
                <span class="room-price">Fetching...</span>
            </div>
            <div class="availability-text">
                <i class="fas fa-door-open me-2"></i>Available Rooms: 
                <span class="room-availability">Fetching...</span>
            </div>
            <div>
                <label class="form-label">
                    <i class="fas fa-calculator me-2"></i>Number of Rooms
                </label>
                <input type="number" class="number-input room-count" min="1" value="1" required>
            </div>
        </div>
    </div>`;

    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = cardHtml;
    const cardElement = tempDiv.firstElementChild;
    document.getElementById('selectedRooms').appendChild(cardElement);

    // âœ… Add event listeners to call updateRoomPriceAndAvailability() only when fields are selected
    cardElement.querySelector(`#acTypeSelect_${uniqueId}`).addEventListener('change', function () {
        if (cardElement.querySelector('.room-type').value) {
            updateRoomPriceAndAvailability(cardElement);
        }
    });

    const bedTypeSelect = cardElement.querySelector(`#bedTypeSelect_${uniqueId}`);
    if (bedTypeSelect) {
        bedTypeSelect.addEventListener('change', function () {
            if (cardElement.querySelector('.room-type').value) {
                updateRoomPriceAndAvailability(cardElement);
            }
        });
    }

    return cardElement;
}


// Function to fetch bed_type from Django backend


async function getBedType(roomTypeId) {
    try {
        let response = await fetch(`/admin-panel/get-room-type/${roomTypeId}/`);
        if (!response.ok) {
            throw new Error(`HTTP Status ${response.status}`);
        }

        let data = await response.json();
        console.log("API Response:", data);

        return data.bed_type || null;
    } catch (error) {
        console.error("Error fetching bed type:", error);
        return null;
    }
}


// Function to get the CSRF token from cookies
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

const seatingCapacityCache = {};

async function getSeatingCapacities(roomTypeId) {
    if (seatingCapacityCache[roomTypeId]) {
        return seatingCapacityCache[roomTypeId]; // Use cached data if available
    }

    try {
        const response = await fetch(`/admin-panel/get-seating-capacities/?roomTypeId=${roomTypeId}`);
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();
        seatingCapacityCache[roomTypeId] = data.seating_capacities || [];
        return seatingCapacityCache[roomTypeId];
    } catch (error) {
        console.error('Error fetching seating capacities:', error);
        return [];
    }
}

function toggleRoomTypeFields() {
    let roomTypeSelect = document.getElementById("roomType");
    if (!roomTypeSelect) {
        console.warn("Warning: RoomType select element is missing from the DOM!");
        return;
    }

    let seatingCapacity = document.getElementById("seatingCapacity");
    let bedType = document.getElementById("bedType");

    if (!seatingCapacity || !bedType) {
        console.warn("Warning: Seating Capacity or Bed Type element missing!");
        return;
    }

    let selectedOption = roomTypeSelect.options[roomTypeSelect.selectedIndex]?.text.toLowerCase();
    if (selectedOption.includes("conference")) {
        seatingCapacity.style.display = "block";
        bedType.style.display = "none";
    } else {
        seatingCapacity.style.display = "none";
        bedType.style.display = "block";
    }

    updateRoomPriceAndAvailability();
}


// âœ… Run toggleRoomTypeFields on page load after DOM is ready
document.addEventListener("DOMContentLoaded", function () {
    let roomTypeSelect = document.getElementById("roomType");

    if (roomTypeSelect) {
        roomTypeSelect.addEventListener("change", toggleRoomTypeFields);
        toggleRoomTypeFields(); // Run once on load
    } else {
        console.error("Error: RoomType select element not found on page load!");
    }

    let seatingCapacitySelect = document.getElementById("seatingCapacity");
    if (seatingCapacitySelect) {
        seatingCapacitySelect.addEventListener("change", onSeatingCapacityChange);
    }
});



document.addEventListener("DOMContentLoaded", function () {
    let roomTypeSelect = document.getElementById("roomType");

    if (roomTypeSelect) {
        roomTypeSelect.addEventListener("change", toggleRoomTypeFields);
    } else {
        console.error("Error: RoomType select element not found on page load!");
    }

    toggleRoomTypeFields(); // Run on page load
});


function onSeatingCapacityChange() {
    console.log("Seating capacity changed");
    updateRoomPriceAndAvailability(); // Ensure this function is defined properly
}

// Attach it to the select element
document.addEventListener("DOMContentLoaded", function () {
    let seatingCapacitySelect = document.getElementById("seatingCapacity");
    if (seatingCapacitySelect) {
        seatingCapacitySelect.addEventListener("change", onSeatingCapacityChange);
    }
});
// Function to add event listeners to room cards
function addRoomCardListeners(cardElement) {
    const acOptions = cardElement.querySelectorAll('.ac-type');
    acOptions.forEach(option => {
        option.addEventListener('change', function () {
            const roomCard = this.closest('.room-card');
            const checkIn = document.querySelector('input[name="check_in"]').value;
            const checkOut = document.querySelector('input[name="check_out"]').value;
            updateRoomPriceAndAvailability(roomCard, checkIn, checkOut);
        });
    });

    const bedOptions = cardElement.querySelectorAll('.bed-type');
    bedOptions.forEach(option => {
        option.addEventListener('change', function () {
            const roomCard = this.closest('.room-card');
            const checkIn = document.querySelector('input[name="check_in"]').value;
            const checkOut = document.querySelector('input[name="check_out"]').value;
            updateRoomPriceAndAvailability(roomCard, checkIn, checkOut);
        });
    });

    const roomCount = cardElement.querySelector('.room-count');
    if (roomCount) {
        roomCount.addEventListener('change', function () {
            const roomCard = this.closest('.room-card');
            const checkIn = document.querySelector('input[name="check_in"]').value;
            const checkOut = document.querySelector('input[name="check_out"]').value;
            updateRoomPriceAndAvailability(roomCard, checkIn, checkOut);
        });
    }
}

// Function to remove room card
function removeRoom(uniqueId) {
    const roomCard = document.getElementById(uniqueId);
    if (roomCard) {
        roomCard.remove();
    }
}

document.getElementById('selectedRooms').addEventListener('change', function(event) {
    if (event.target.matches('select[id^="roomTypeSelect_"]') || event.target.matches('select[id^="bedTypeSelect_"]') || event.target.matches('select[id^="acTypeSelect_"]')) {
        const roomCard = event.target.closest('.room-card');
        const checkIn = document.querySelector('input[name="check_in"]').value;
        const checkOut = document.querySelector('input[name="check_out"]').value;
        updateRoomPriceAndAvailability(roomCard, checkIn, checkOut);
    }
});
  
document.querySelectorAll('input[name="proof_type"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const proofInput = document.getElementById('proofInput');
        const proofLabel = document.getElementById('proofLabel');
        const proofText = document.getElementById('proofText');
        
        switch(this.value) {
            case 'aadhar':
                proofLabel.textContent = 'Aadhar Number';
                proofInput.placeholder = 'Enter 12 digit Aadhar number';
                proofText.textContent = 'Enter 12 digit Aadhar number without spaces';
                break;
            case 'pan':
                proofLabel.textContent = 'PAN Number';
                proofInput.placeholder = 'Enter PAN number';
                proofText.textContent = 'Enter 10 character PAN number';
                break;
            case 'passport':
                proofLabel.textContent = 'Passport Number';
                proofInput.placeholder = 'Enter Passport number';
                proofText.textContent = 'Enter Passport number';
                break;
        }
        
        // Clear and enable input
        proofInput.value = '';
        proofInput.disabled = false;
    });
});
// Input validation
document.getElementById('proofInput').addEventListener('input', function() {
    const proofType = document.querySelector('input[name="proof_type"]:checked')?.value;
    let isValid = false;
    
    switch(proofType) {
        case 'aadhar':
            isValid = /^\d{12}$/.test(this.value);
            this.value = this.value.replace(/\D/g, '').slice(0, 12);
            break;
        case 'pan':
            isValid = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(this.value);
            this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 10);
            break;
        case 'passport':
            isValid = /^[A-Z]{1}[0-9]{7}$/.test(this.value);
            this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 8);
            break;
    }
    
    if (this.value && !isValid) {
        this.classList.add('is-invalid');
    } else {
        this.classList.remove('is-invalid');
    }
});
    

// tax breakdown javascript
function displayTaxBreakdown(breakdown = [], totalWithTax = 0) {
    const container = document.getElementById('taxBreakdownContainer');
    container.innerHTML = ''; // Clear any previous entries

    if (!breakdown.length) return;

    breakdown.forEach(item => {
        const line = document.createElement('div');
        line.className = 'text-end text-muted';
        line.innerHTML = `${item.name} (${item.percentage}%): â‚¹${parseFloat(item.amount).toFixed(2)}`;
        container.appendChild(line);
    });

    // Update total
    document.getElementById('totalAmount').textContent = `â‚¹${parseFloat(totalWithTax).toFixed(2)}/-`;
    document.getElementById('finalTotalWithTaxInput').value = parseFloat(totalWithTax).toFixed(2);
}


</script>
  


<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Apply dark mode to offcanvas if dark mode is active
    function updateOffcanvasTheme() {
      const isDarkMode = document.body.classList.contains('dark-mode');
      const offcanvas = document.getElementById('bookingOffcanvas');
      
      if (offcanvas) {
        if (isDarkMode) {
          offcanvas.setAttribute('data-theme', 'dark');
        } else {
          offcanvas.removeAttribute('data-theme');
        }
      }
    }
    
    // Initial theme application
    updateOffcanvasTheme();
    
    // Listen for theme changes
    const toggleButton = document.getElementById('toggleMode');
    if (toggleButton) {
      toggleButton.addEventListener('click', function() {
        // Wait for the dark-mode class to be toggled by the existing event handler
        setTimeout(updateOffcanvasTheme, 10);
      });
    }
    
    // Also update when offcanvas is shown
    const bookingOffcanvas = document.getElementById('bookingOffcanvas');
    if (bookingOffcanvas) {
      bookingOffcanvas.addEventListener('show.bs.offcanvas', updateOffcanvasTheme);
    }
  });
</script>
{% endblock %}
