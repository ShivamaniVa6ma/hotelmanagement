{% extends 'base.html' %}
{% block content %}


<style>
#tax-list {
    margin-top: 30px;
}
 /* Main styling */
 #tax-list {
        margin-top: 30px;
    }
    
    .tax-page-container {
        padding: 30px 0;
    }
    
    .tax-header {
        background: linear-gradient(135deg, #2224ad 0%, #4a90e2 100%);
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .tax-header h2 {
        color: white;
        margin: 0;
        font-weight: 600;
        font-size: 1.8rem;
    }
    
  /* Enhanced form styling */
.tax-form-container {
    background: white;
    border-radius: 15px;
    padding: 35px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    margin-bottom: 40px;
    transition: all 0.3s ease;
    border-left: 5px solid   #330481;
}

.tax-form-container:hover {
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    transform: translateY(-5px);
}

.tax-form-container h3 {
    color: #333;
    font-weight: 600;
    margin-bottom: 25px;
    position: relative;
    padding-bottom: 15px;
}

.tax-form-container h3:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 60px;
    height: 3px;
    background: linear-gradient(90deg, #2224ad, #4a90e2);
    border-radius: 3px;
}

.form-label {
    font-weight: 500;
    color: var(--text-color);
    margin-bottom: 10px;
    display: block;
    font-size: 0.95rem;
}

.input-group {
    margin-bottom: 5px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.03);
    border-radius: 8px;
    overflow: hidden;
}

.input-group-text {
    background-color: #f8f9fa;
    border-color: #e0e0e0;
    color: #4a90e2;
}

.form-control {
    border-radius: 0 8px 8px 0;
    padding: 12px 15px;
    border: 1px solid #e0e0e0;
    transition: all 0.3s ease;
    height: auto;
    font-size: 0.95rem;
}

.form-control:focus {
    border-color: #4a90e2;
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
}

.form-actions {
    margin-top: 30px;
}

.btn-primary {
    background: linear-gradient(135deg, #2224ad 0%, #4a90e2 100%);
    border: none;
    border-radius: 8px;
    padding: 12px 30px;
    font-weight: 500;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
}

.btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(74, 144, 226, 0.4);
}

.alert {
    border-radius: 10px;
    padding: 15px 20px;
    margin-bottom: 25px;
    border: none;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
}

.alert-success {
    background-color: #e3f7ec;
    color: #0d6832;
}

.alert-danger {
    background-color: #fce8e8;
    color: #b71c1c;
}

.alert-warning {
    background-color: #fff8e1;
    color: #b7791c;
}

.alert-info {
    background-color: #e3f2fd;
    color: #0d47a1;
}

.text-danger {
    font-size: 0.85rem;
    display: flex;
    align-items: center;
}

/* Responsive adjustments */
@media (max-width: 767px) {
    .tax-form-container {
        padding: 25px 20px;
    }
    
    .form-actions {
        text-align: center;
    }
    
    .btn-primary {
        width: 100%;
    }
}

/* Add animation classes */
.animate__animated {
    animation-duration: 0.8s;
}

.animate__fadeIn {
    animation-name: fadeIn;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}
    
  /* Enhanced Table Styling */
.table {
    margin-bottom: 0;
    border-collapse: separate;
    border-spacing: 0;
    width: 100%;
}

.table thead th {
    background-color: #f8f9fa;
    border-bottom: 2px solid #e9ecef;
    color: #495057;
    font-weight: 600;
    padding: 15px;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.table tbody td {
    padding: 15px;
    vertical-align: middle;
    border-bottom: 1px solid #e9ecef;
    transition: all 0.2s ease;
}

.table-hover tbody tr:hover {
    background-color: rgba(74, 144, 226, 0.05);
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
}

/* Tax Name Styling */
.tax-name {
    display: flex;
    align-items: center;
    gap: 10px;
}

.tax-icon {
    color: #4a90e2;
    font-size: 1.2rem;
    background: rgba(74, 144, 226, 0.1);
    padding: 8px;
    border-radius: 8px;
}

/* Tax Badge Styling */
.tax-badge {
    background: linear-gradient(135deg, #2224ad 0%, #4a90e2 100%);
    color: white;
    padding: 5px 12px;
    border-radius: 20px;
    font-weight: 500;
    font-size: 0.85rem;
    display: inline-block;
    box-shadow: 0 2px 5px rgba(74, 144, 226, 0.2);
}

/* Action Buttons Styling */
.action-buttons {
    display: flex;
    justify-content: center;
    gap: 8px;
}

.btn-sm {
    padding: 6px 12px;
    font-size: 0.85rem;
    border-radius: 6px;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: all 0.3s ease;
}

.btn-warning {
    background: linear-gradient(135deg, #4100ff 0%, #22d13f 100%);
    /* background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%); */
    border: none;
    color: white;
    box-shadow: 0 2px 5px rgba(255, 152, 0, 0.2);
}

.btn-danger {
    background: linear-gradient(135deg, #da1b0d 0%, #ff5252 100%);
    border: none;
    color: white;
    box-shadow: 0 2px 5px rgba(244, 67, 54, 0.2);
}

.btn-warning:hover, .btn-danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

/* Empty State Styling */
.empty-state {
    padding: 40px !important;
}

.empty-tax-list {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
}

.empty-icon {
    font-size: 3rem;
    color: #ccc;
    background: #f8f9fa;
    padding: 20px;
    border-radius: 50%;
}

.empty-tax-list p {
    color: #888;
    font-size: 1rem;
    margin: 0;
}

/* Responsive Adjustments */
@media (max-width: 767px) {
    .table thead th {
        padding: 12px 10px;
        font-size: 0.8rem;
    }
    
    .table tbody td {
        padding: 12px 10px;
    }
    
    .tax-icon {
        padding: 6px;
        font-size: 1rem;
    }
    
    .tax-badge {
        padding: 4px 10px;
        font-size: 0.8rem;
    }
    
    .btn-sm {
        padding: 5px 10px;
        font-size: 0.8rem;
    }
    
    .action-buttons {
        flex-direction: column;
        gap: 5px;
    }
}

@media (max-width: 575px) {
    .table thead th:first-child,
    .table tbody td:first-child {
        display: none;
    }
    
    .action-buttons {
        flex-direction: row;
    }
    
    .btn-sm {
        padding: 5px 8px;
    }
    
    .btn-sm i {
        margin-right: 0;
    }
    
    .btn-sm span {
        display: none;
    }
}

.lh-card {
    background-color: var(--card-bg);
    border-color: var(--border-color);
}
</style>


{% load static %}

<div class="lh-main-content">
    <div class="container-fluid tax-page-container">
 
       <!-- Page title & breadcrumb -->
				<div class="lh-page-title lh-page-title-2">
					<div class="lh-breadcrumb">
						<h5>Tax Management</h5>
						<ul>
							<li><a href="{% url 'admin-panel:index' %}">Home</a></li>
                            <li> <i class="fas fa-angle-right pl3 pr3"></i></li>
							<li>Tax</li>
						</ul>
					</div>
				</div>
        <div class="tax-form-container tax_default_color mt-5">
            <h3 class="mb-4 default_color">Add New Tax</h3>

            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} animate__animated animate__fadeIn">
                        <i class="ri-information-line me-2"></i>{{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <form method="POST" class="tax-form" style="display: flex;justify-content: space-between;align-items: center;">
                {% csrf_token %}

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_name" class="form-label">
                                <i class="ri-price-tag-3-line me-2"></i>Tax Name
                            </label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="ri-text"></i></span>
                                {{ form.name }}
                            </div>
                            {% if form.name.errors %}
                                <div class="text-danger mt-2">
                                    <i class="ri-error-warning-line me-1"></i>{{ form.name.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_percentage" class="form-label">
                                <i class="ri-percent-line me-2"></i>Tax Percentage
                            </label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="ri-percent-line"></i></span>
                                {{ form.percentage }}
                                <span class="input-group-text">%</span>
                            </div>
                            {% if form.percentage.errors %}
                                <div class="text-danger mt-2">
                                    <i class="ri-error-warning-line me-1"></i>{{ form.percentage.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="form-actions mt-4 text-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="ri-add-line me-2"></i>Add Tax
                    </button>
                </div>
            </form>
        </div>

        <div class="row">
            <div class="col-xl-12 col-md-12" id="tax-list">
                <div class="lh-card" id="bookingtbl">
                    <div class="lh-card-header">
                        <h4 class="lh-card-title">Tax List</h4>
                        <div class="header-tools">
                            <a href="javascript:void(0)" class="m-r-10 lh-full-card"><i
                                    class="ri-fullscreen-line" title="Full Screen"></i></a>
                            <!-- <div class="lh-date-range dots">
                                <span></span>
                            </div> -->
                        </div>
                    </div>
                    <div class="lh-card-content card-default">
                        <div class="booking-table">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr class="default_color">
                                            <th class="text-center">#</th>
                                            <th>Tax Name</th>
                                            <th class="text-center">Percentage</th>
                                            <th class="text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for tax in taxes %}
                                        <tr>
                                            <td class="text-center">{{ tax.id }}</td>
                                            <td>
                                                <div class="tax-name">
                                                    <i class="ri-price-tag-3-line tax-icon"></i>
                                                    <span>{{ tax.name }}</span>
                                                </div>
                                            </td>
                                            <td class="text-center">
                                                <span class="tax-badge">{{ tax.percentage }}%</span>
                                            </td>
                                            <td class="text-center">
                                                <div class="action-buttons">
                                                    <button class="btn btn-warning btn-sm edit-tax-btn"
                                                        data-id="{{ tax.id }}"
                                                        data-name="{{ tax.name }}"
                                                        data-percentage="{{ tax.percentage }}"
                                                        data-platform="{{ tax.is_platform_fee }}">
                                                        <i class="ri-edit-line"></i> Edit
                                                    </button>
                                                    <button class="btn btn-danger btn-sm delete-tax-btn" data-id="{{ tax.id }}">
                                                        <i class="ri-delete-bin-line"></i> Delete
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="4" class="text-center empty-state">
                                                <div class="empty-tax-list">
                                                    <i class="ri-file-list-3-line empty-icon"></i>
                                                    <p>No Tax List found.</p>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



<script>
    // DELETE
    $(document).on('click', '.delete-tax-btn', function () {
    const taxId = $(this).data('id');
    Swal.fire({
        title: 'Are you sure?',
        text: "You won’t be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, delete it!',
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: '{% url "admin-panel:delete_tax" %}',
                method: 'POST',
                data: {
                    id: taxId,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    if (response.success) {
                        Swal.fire('Deleted!', response.message, 'success').then(() => {
                            location.reload();  // 🔁 Page will auto-refresh here
                        });
                    } else {
                        Swal.fire('Error!', response.message, 'error');
                    }
                }
            });
        }
    });
});

   $(document).on('click', '.edit-tax-btn', function () {
    const id = $(this).data('id');
    const name = $(this).data('name');
    const percentage = $(this).data('percentage');

    Swal.fire({
        title: 'Edit Tax',
        html:
            `<input id="tax-name" class="swal2-input" placeholder="Name" value="${name}">` +
            `<input id="tax-percentage" class="swal2-input" placeholder="Percentage" value="${percentage}">` ,
        focusConfirm: false,
        showCancelButton: true,
        preConfirm: () => {
            return {
                id: id,
                name: $('#tax-name').val(),
                percentage: $('#tax-percentage').val(),
                is_platform_fee: $('input[name="tax-platform"]:checked').val()
            }
        }
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: '{% url "admin-panel:edit_tax" %}',  // Update this URL in your view
                method: 'POST',
                data: {
                    id: result.value.id,
                    name: result.value.name,
                    percentage: result.value.percentage,
                    is_platform_fee: result.value.is_platform_fee,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    if (response.success) {
                        Swal.fire('Updated!', response.message, 'success').then(() => {
                            location.reload();
                        });
                    } else {
                        Swal.fire('Error!', response.message, 'error');
                    }
                }
            });
        }
    });
});


</script>

{% endblock %}